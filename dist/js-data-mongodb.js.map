{"version":3,"sources":["webpack:///webpack/bootstrap 9c83c6111e94a2255e9d","webpack:///./src/index.js","webpack:///external \"mongodb\"","webpack:///external \"bson\"","webpack:///external \"mout/array/map\"","webpack:///external \"js-data\"","webpack:///external \"mout/string/underscore\"","webpack:///external \"mout/array/unique\""],"names":[],"mappings":"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","file":"./dist/js-data-mongodb.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 9c83c6111e94a2255e9d\n **/","const mongodb = require('mongodb')\r\nconst MongoClient = mongodb.MongoClient\r\nconst bson = require('bson')\r\nconst map = require('mout/array/map')\r\nconst ObjectID = bson.ObjectID\r\nconst JSData = require('js-data')\r\nconst underscore = require('mout/string/underscore')\r\nconst unique = require('mout/array/unique')\r\nconst { DSUtils } = JSData\r\n\r\nconst reserved = [\r\n  'orderBy',\r\n  'sort',\r\n  'limit',\r\n  'offset',\r\n  'skip',\r\n  'where'\r\n]\r\n\r\nclass Defaults {\r\n\r\n}\r\n\r\nDefaults.prototype.translateId = true\r\n\r\nclass DSMongoDBAdapter {\r\n  constructor (opts) {\r\n    if (typeof opts === 'string') {\r\n      opts = { uri: opts }\r\n    }\r\n    opts.uri || (opts.uri = 'mongodb://localhost:27017')\r\n    this.defaults = new Defaults()\r\n    DSUtils.deepMixIn(this.defaults, opts)\r\n    this.client = new DSUtils.Promise(function (resolve, reject) {\r\n      MongoClient.connect(opts.uri, function (err, db) {\r\n        return err ? reject(err) : resolve(db)\r\n      })\r\n    })\r\n  }\r\n\r\n  getClient () {\r\n    return this.client\r\n  }\r\n\r\n  getQuery (resourceConfig, params) {\r\n    params = params || {}\r\n    params.where = params.where || {}\r\n\r\n    DSUtils.forOwn(params, function (v, k) {\r\n      if (reserved.indexOf(k) === -1) {\r\n        if (DSUtils.isObject(v)) {\r\n          params.where[k] = v\r\n        } else {\r\n          params.where[k] = {\r\n            '==': v\r\n          }\r\n        }\r\n        delete params[k]\r\n      }\r\n    })\r\n\r\n    let query = {}\r\n\r\n    if (Object.keys(params.where).length) {\r\n      DSUtils.forOwn(params.where, function (criteria, field) {\r\n        if (!DSUtils.isObject(criteria)) {\r\n          params.where[field] = {\r\n            '==': criteria\r\n          }\r\n        }\r\n        DSUtils.forOwn(criteria, function (v, op) {\r\n          if (op === '==' || op === '===') {\r\n            query[field] = v\r\n          } else if (op === '!=' || op === '!==') {\r\n            query[field] = query[field] || {}\r\n            query[field].$ne = v\r\n          } else if (op === '>') {\r\n            query[field] = query[field] || {}\r\n            query[field].$gt = v\r\n          } else if (op === '>=') {\r\n            query[field] = query[field] || {}\r\n            query[field].$gte = v\r\n          } else if (op === '<') {\r\n            query[field] = query[field] || {}\r\n            query[field].$lt = v\r\n          } else if (op === '<=') {\r\n            query[field] = query[field] || {}\r\n            query[field].$lte = v\r\n          } else if (op === 'in') {\r\n            query[field] = query[field] || {}\r\n            query[field].$in = v\r\n          } else if (op === 'notIn') {\r\n            query[field] = query[field] || {}\r\n            query[field].$nin = v\r\n          } else if (op === '|==' || op === '|===') {\r\n            query.$or = query.$or || []\r\n            let orEqQuery = {}\r\n            orEqQuery[field] = v\r\n            query.$or.push(orEqQuery)\r\n          } else if (op === '|!=' || op === '|!==') {\r\n            query.$or = query.$or || []\r\n            let orNeQuery = {}\r\n            orNeQuery[field] = {\r\n              '$ne': v\r\n            }\r\n            query.$or.push(orNeQuery)\r\n          } else if (op === '|>') {\r\n            query.$or = query.$or || []\r\n            let orGtQuery = {}\r\n            orGtQuery[field] = {\r\n              '$gt': v\r\n            }\r\n            query.$or.push(orGtQuery)\r\n          } else if (op === '|>=') {\r\n            query.$or = query.$or || []\r\n            let orGteQuery = {}\r\n            orGteQuery[field] = {\r\n              '$gte': v\r\n            }\r\n            query.$or.push(orGteQuery)\r\n          } else if (op === '|<') {\r\n            query.$or = query.$or || []\r\n            let orLtQuery = {}\r\n            orLtQuery[field] = {\r\n              '$lt': v\r\n            }\r\n            query.$or.push(orLtQuery)\r\n          } else if (op === '|<=') {\r\n            query.$or = query.$or || []\r\n            let orLteQuery = {}\r\n            orLteQuery[field] = {\r\n              '$lte': v\r\n            }\r\n            query.$or.push(orLteQuery)\r\n          } else if (op === '|in') {\r\n            query.$or = query.$or || []\r\n            let orInQuery = {}\r\n            orInQuery[field] = {\r\n              '$in': v\r\n            }\r\n            query.$or.push(orInQuery)\r\n          } else if (op === '|notIn') {\r\n            query.$or = query.$or || []\r\n            let orNinQuery = {}\r\n            orNinQuery[field] = {\r\n              '$nin': v\r\n            }\r\n            query.$or.push(orNinQuery)\r\n          }\r\n        })\r\n      })\r\n    }\r\n\r\n    return query\r\n  }\r\n\r\n  getQueryOptions (resourceConfig, params) {\r\n    params = params || {}\r\n    params.orderBy = params.orderBy || params.sort\r\n    params.skip = params.skip || params.offset\r\n\r\n    let queryOptions = {}\r\n\r\n    if (params.orderBy) {\r\n      if (DSUtils.isString(params.orderBy)) {\r\n        params.orderBy = [\r\n          [params.orderBy, 'asc']\r\n        ]\r\n      }\r\n      for (var i = 0; i < params.orderBy.length; i++) {\r\n        if (DSUtils.isString(params.orderBy[i])) {\r\n          params.orderBy[i] = [params.orderBy[i], 'asc']\r\n        }\r\n      }\r\n      queryOptions.sort = params.orderBy\r\n    }\r\n\r\n    if (params.skip) {\r\n      queryOptions.skip = +params.skip\r\n    }\r\n\r\n    if (params.limit) {\r\n      queryOptions.limit = +params.limit\r\n    }\r\n\r\n    return queryOptions\r\n  }\r\n\r\n  translateId (r, options) {\r\n    options = options || {}\r\n    if (typeof options.translateId === 'boolean' ? options.translateId : this.defaults.translateId) {\r\n      if (Array.isArray(r)) {\r\n        r.forEach((_r) => {\r\n          let __id = _r._id ? _r._id.toString() : _r._id\r\n          _r._id = typeof __id === 'string' ? __id : _r._id\r\n        })\r\n      } else if (DSUtils.isObject(r)) {\r\n        let __id = r._id ? r._id.toString() : r._id\r\n        r._id = typeof __id === 'string' ? __id : r._id\r\n      }\r\n    }\r\n    return r\r\n  }\r\n\r\n  origify (options) {\r\n    options = options || {}\r\n    if (typeof options.orig === 'function') {\r\n      return options.orig()\r\n    }\r\n    return options\r\n  }\r\n\r\n  find (resourceConfig, id, options) {\r\n    let instance\r\n    options = this.origify(options)\r\n    options.with = options.with || []\r\n    return this.getClient().then((client) => {\r\n      return new DSUtils.Promise((resolve, reject) => {\r\n        let params = {}\r\n        params[resourceConfig.idAttribute] = id\r\n        if (resourceConfig.idAttribute === '_id' && typeof id === 'string' && ObjectID.isValid(id)) {\r\n          params[resourceConfig.idAttribute] = ObjectID.createFromHexString(id)\r\n        }\r\n        options.fields = options.fields || {}\r\n        client.collection(resourceConfig.table || underscore(resourceConfig.name)).findOne(params, options, (err, r) => {\r\n          if (err) {\r\n            reject(err)\r\n          } else if (!r) {\r\n            reject(new Error('Not Found!'))\r\n          } else {\r\n            resolve(this.translateId(r, options))\r\n          }\r\n        })\r\n      })\r\n    }).then((_instance) => {\r\n      instance = _instance\r\n      let tasks = []\r\n\r\n      DSUtils.forEach(resourceConfig.relationList, (def) => {\r\n        let relationName = def.relation\r\n        let relationDef = resourceConfig.getResource(relationName)\r\n        let containedName = null\r\n        if (DSUtils.contains(options.with, relationName)) {\r\n          containedName = relationName\r\n        } else if (DSUtils.contains(options.with, def.localField)) {\r\n          containedName = def.localField\r\n        }\r\n        if (containedName) {\r\n          let __options = DSUtils.deepMixIn({}, options.orig ? options.orig() : options)\r\n          __options.with = options.with.slice()\r\n          __options = DSUtils._(relationDef, __options)\r\n          DSUtils.remove(__options.with, containedName)\r\n          DSUtils.forEach(__options.with, (relation, i) => {\r\n            if (relation && relation.indexOf(containedName) === 0 && relation.length >= containedName.length && relation[containedName.length] === '.') {\r\n              __options.with[i] = relation.substr(containedName.length + 1)\r\n            } else {\r\n              __options.with[i] = ''\r\n            }\r\n          })\r\n\r\n          let task\r\n\r\n          if ((def.type === 'hasOne' || def.type === 'hasMany') && def.foreignKey) {\r\n            task = this.findAll(resourceConfig.getResource(relationName), {\r\n              where: {\r\n                [def.foreignKey]: {\r\n                  '==': instance[resourceConfig.idAttribute]\r\n                }\r\n              }\r\n            }, __options).then((relatedItems) => {\r\n              if (def.type === 'hasOne' && relatedItems.length) {\r\n                DSUtils.set(instance, def.localField, relatedItems[0])\r\n              } else {\r\n                DSUtils.set(instance, def.localField, relatedItems)\r\n              }\r\n              return relatedItems\r\n            })\r\n          } else if (def.type === 'hasMany' && def.localKeys) {\r\n            let localKeys = []\r\n            let itemKeys = instance[def.localKeys] || []\r\n            itemKeys = Array.isArray(itemKeys) ? itemKeys : DSUtils.keys(itemKeys)\r\n            localKeys = localKeys.concat(itemKeys || [])\r\n            task = this.findAll(resourceConfig.getResource(relationName), {\r\n              where: {\r\n                [relationDef.idAttribute]: {\r\n                  'in': map(DSUtils.filter(unique(localKeys), (x) => x), (x) => new ObjectID(x))\r\n                }\r\n              }\r\n            }, __options).then((relatedItems) => {\r\n              DSUtils.set(instance, def.localField, relatedItems)\r\n              return relatedItems\r\n            })\r\n          } else if (def.type === 'belongsTo' || (def.type === 'hasOne' && def.localKey)) {\r\n            task = this.find(resourceConfig.getResource(relationName), DSUtils.get(instance, def.localKey), __options).then((relatedItem) => {\r\n              DSUtils.set(instance, def.localField, relatedItem)\r\n              return relatedItem\r\n            })\r\n          }\r\n\r\n          if (task) {\r\n            tasks.push(task)\r\n          }\r\n        }\r\n      })\r\n\r\n      return DSUtils.Promise.all(tasks)\r\n    }).then(() => instance)\r\n  }\r\n\r\n  findAll (resourceConfig, params, options) {\r\n    let items = null\r\n    options = this.origify(options ? DSUtils.copy(options) : {})\r\n    options.with = options.with || []\r\n    DSUtils.deepMixIn(options, this.getQueryOptions(resourceConfig, params))\r\n    let query = this.getQuery(resourceConfig, params)\r\n    return this.getClient().then((client) => {\r\n      return new DSUtils.Promise((resolve, reject) => {\r\n        options.fields = options.fields || {}\r\n        client.collection(resourceConfig.table || underscore(resourceConfig.name)).find(query, options).toArray((err, r) => {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve(this.translateId(r, options))\r\n          }\r\n        })\r\n      })\r\n    }).then((_items) => {\r\n      items = _items\r\n      let tasks = []\r\n      DSUtils.forEach(resourceConfig.relationList, (def) => {\r\n        let relationName = def.relation\r\n        let relationDef = resourceConfig.getResource(relationName)\r\n        let containedName = null\r\n        if (DSUtils.contains(options.with, relationName)) {\r\n          containedName = relationName\r\n        } else if (DSUtils.contains(options.with, def.localField)) {\r\n          containedName = def.localField\r\n        }\r\n        if (containedName) {\r\n          let __options = DSUtils.deepMixIn({}, options.orig ? options.orig() : options)\r\n          __options.with = options.with.slice()\r\n          __options = DSUtils._(relationDef, __options)\r\n          DSUtils.remove(__options.with, containedName)\r\n          DSUtils.forEach(__options.with, (relation, i) => {\r\n            if (relation && relation.indexOf(containedName) === 0 && relation.length >= containedName.length && relation[containedName.length] === '.') {\r\n              __options.with[i] = relation.substr(containedName.length + 1)\r\n            } else {\r\n              __options.with[i] = ''\r\n            }\r\n          })\r\n\r\n          let task\r\n\r\n          if ((def.type === 'hasOne' || def.type === 'hasMany') && def.foreignKey) {\r\n            task = this.findAll(resourceConfig.getResource(relationName), {\r\n              where: {\r\n                [def.foreignKey]: {\r\n                  'in': DSUtils.filter(map(items, (item) => DSUtils.get(item, resourceConfig.idAttribute)), (x) => x)\r\n                }\r\n              }\r\n            }, __options).then((relatedItems) => {\r\n              DSUtils.forEach(items, (item) => {\r\n                let attached = []\r\n                DSUtils.forEach(relatedItems, (relatedItem) => {\r\n                  if (DSUtils.get(relatedItem, def.foreignKey) === item[resourceConfig.idAttribute]) {\r\n                    attached.push(relatedItem)\r\n                  }\r\n                })\r\n                if (def.type === 'hasOne' && attached.length) {\r\n                  DSUtils.set(item, def.localField, attached[0])\r\n                } else {\r\n                  DSUtils.set(item, def.localField, attached)\r\n                }\r\n              })\r\n              return relatedItems\r\n            })\r\n          } else if (def.type === 'hasMany' && def.localKeys) {\r\n            let localKeys = []\r\n            DSUtils.forEach(items, (item) => {\r\n              let itemKeys = item[def.localKeys] || []\r\n              itemKeys = Array.isArray(itemKeys) ? itemKeys : DSUtils.keys(itemKeys)\r\n              localKeys = localKeys.concat(itemKeys || [])\r\n            })\r\n            task = this.findAll(resourceConfig.getResource(relationName), {\r\n              where: {\r\n                [relationDef.idAttribute]: {\r\n                  'in': map(DSUtils.filter(unique(localKeys), (x) => x), (x) => new ObjectID(x))\r\n                }\r\n              }\r\n            }, __options).then((relatedItems) => {\r\n              DSUtils.forEach(items, (item) => {\r\n                let attached = []\r\n                let itemKeys = item[def.localKeys] || []\r\n                itemKeys = Array.isArray(itemKeys) ? itemKeys : DSUtils.keys(itemKeys)\r\n                DSUtils.forEach(relatedItems, (relatedItem) => {\r\n                  if (itemKeys && DSUtils.contains(itemKeys, relatedItem[relationDef.idAttribute])) {\r\n                    attached.push(relatedItem)\r\n                  }\r\n                })\r\n                DSUtils.set(item, def.localField, attached)\r\n              })\r\n              return relatedItems\r\n            })\r\n          } else if (def.type === 'belongsTo' || (def.type === 'hasOne' && def.localKey)) {\r\n            task = this.findAll(resourceConfig.getResource(relationName), {\r\n              where: {\r\n                [relationDef.idAttribute]: {\r\n                  'in': map(DSUtils.filter(map(items, (item) => DSUtils.get(item, def.localKey)), (x) => x), (x) => new ObjectID(x))\r\n                }\r\n              }\r\n            }, __options).then((relatedItems) => {\r\n              DSUtils.forEach(items, (item) => {\r\n                DSUtils.forEach(relatedItems, (relatedItem) => {\r\n                  if (relatedItem[relationDef.idAttribute] === item[def.localKey]) {\r\n                    DSUtils.set(item, def.localField, relatedItem)\r\n                  }\r\n                })\r\n              })\r\n              return relatedItems\r\n            })\r\n          }\r\n\r\n          if (task) {\r\n            tasks.push(task)\r\n          }\r\n        }\r\n      })\r\n      return DSUtils.Promise.all(tasks)\r\n    }).then(() => items)\r\n  }\r\n\r\n  create (resourceConfig, attrs, options) {\r\n    options = this.origify(options)\r\n    attrs = DSUtils.removeCircular(DSUtils.omit(attrs, resourceConfig.relationFields || []))\r\n    return this.getClient().then((client) => {\r\n      return new DSUtils.Promise((resolve, reject) => {\r\n        let collection = client.collection(resourceConfig.table || underscore(resourceConfig.name))\r\n        let method = collection.insertOne ? DSUtils.isArray(attrs) ? 'insertMany' : 'insertOne' : 'insert'\r\n        collection[method](attrs, options, (err, r) => {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            r = r.ops ? r.ops : r\r\n            this.translateId(r, options)\r\n            resolve(DSUtils.isArray(attrs) ? r : r[0])\r\n          }\r\n        })\r\n      })\r\n    })\r\n  }\r\n\r\n  update (resourceConfig, id, attrs, options) {\r\n    attrs = DSUtils.removeCircular(DSUtils.omit(attrs, resourceConfig.relationFields || []))\r\n    options = this.origify(options)\r\n    return this.find(resourceConfig, id, options).then(() => {\r\n      return this.getClient()\r\n    }).then((client) => {\r\n      return new DSUtils.Promise((resolve, reject) => {\r\n        let params = {}\r\n        params[resourceConfig.idAttribute] = id\r\n        if (resourceConfig.idAttribute === '_id' && typeof id === 'string' && ObjectID.isValid(id)) {\r\n          params[resourceConfig.idAttribute] = ObjectID.createFromHexString(id)\r\n        }\r\n        let collection = client.collection(resourceConfig.table || underscore(resourceConfig.name))\r\n        collection[collection.updateOne ? 'updateOne' : 'update'](params, {$set: attrs}, options, (err) => {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve()\r\n          }\r\n        })\r\n      })\r\n    }).then(() => this.find(resourceConfig, id, options))\r\n  }\r\n\r\n  updateAll (resourceConfig, attrs, params, options) {\r\n    let ids = []\r\n    attrs = DSUtils.removeCircular(DSUtils.omit(attrs, resourceConfig.relationFields || []))\r\n    options = this.origify(options ? DSUtils.copy(options) : {})\r\n    let _options = DSUtils.copy(options)\r\n    _options.multi = true\r\n    return this.getClient().then((client) => {\r\n      let queryOptions = this.getQueryOptions(resourceConfig, params)\r\n      queryOptions.$set = attrs\r\n      let query = this.getQuery(resourceConfig, params)\r\n      return this.findAll(resourceConfig, params, options).then((items) => {\r\n        ids = map(items, (item) => {\r\n          let id = item[resourceConfig.idAttribute]\r\n          if (resourceConfig.idAttribute === '_id' && typeof id === 'string' && ObjectID.isValid(id)) {\r\n            return ObjectID.createFromHexString(id)\r\n          }\r\n          return id\r\n        })\r\n        return new DSUtils.Promise((resolve, reject) => {\r\n          let collection = client.collection(resourceConfig.table || underscore(resourceConfig.name))\r\n          collection[collection.updateMany ? 'updateMany' : 'update'](query, queryOptions, _options, (err) => {\r\n            if (err) {\r\n              reject(err)\r\n            } else {\r\n              resolve()\r\n            }\r\n          })\r\n        })\r\n      }).then(() => {\r\n        let _params = {}\r\n        _params[resourceConfig.idAttribute] = {\r\n          'in': ids\r\n        }\r\n        return this.findAll(resourceConfig, _params, options)\r\n      })\r\n    })\r\n  }\r\n\r\n  destroy (resourceConfig, id, options) {\r\n    options = this.origify(options)\r\n    return this.getClient().then((client) => {\r\n      return new DSUtils.Promise((resolve, reject) => {\r\n        let params = {}\r\n        params[resourceConfig.idAttribute] = id\r\n        if (resourceConfig.idAttribute === '_id' && typeof id === 'string' && ObjectID.isValid(id)) {\r\n          params[resourceConfig.idAttribute] = ObjectID.createFromHexString(id)\r\n        }\r\n        let collection = client.collection(resourceConfig.table || underscore(resourceConfig.name))\r\n        collection[collection.deleteOne ? 'deleteOne' : 'remove'](params, options, (err) => {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve()\r\n          }\r\n        })\r\n      })\r\n    })\r\n  }\r\n\r\n  destroyAll (resourceConfig, params, options) {\r\n    options = this.origify(options ? DSUtils.copy(options) : {})\r\n    return this.getClient().then((client) => {\r\n      DSUtils.deepMixIn(options, this.getQueryOptions(resourceConfig, params))\r\n      let query = this.getQuery(resourceConfig, params)\r\n      return new DSUtils.Promise((resolve, reject) => {\r\n        let collection = client.collection(resourceConfig.table || underscore(resourceConfig.name))\r\n        collection[collection.deleteMany ? 'deleteMany' : 'remove'](query, options, (err) => {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve()\r\n          }\r\n        })\r\n      })\r\n    })\r\n  }\r\n}\r\n\r\nmodule.exports = DSMongoDBAdapter\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","module.exports = require(\"mongodb\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mongodb\"\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = require(\"bson\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"bson\"\n ** module id = 2\n ** module chunks = 0\n **/","module.exports = require(\"mout/array/map\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mout/array/map\"\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"js-data\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"js-data\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = require(\"mout/string/underscore\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mout/string/underscore\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = require(\"mout/array/unique\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mout/array/unique\"\n ** module id = 6\n ** module chunks = 0\n **/"],"sourceRoot":""}