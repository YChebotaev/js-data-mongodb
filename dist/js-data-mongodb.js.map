{"version":3,"file":"js-data-mongodb.js","sources":["../src/index.js"],"sourcesContent":["const mongodb = require('mongodb')\r\nconst MongoClient = mongodb.MongoClient\r\nconst bson = require('bson')\r\nconst ObjectID = bson.ObjectID\r\nconst JSData = require('js-data')\r\nconst underscore = require('mout/string/underscore')\r\nconst { DSUtils } = JSData\r\n\r\nconst reserved = [\r\n  'orderBy',\r\n  'sort',\r\n  'limit',\r\n  'offset',\r\n  'skip',\r\n  'where'\r\n]\r\n\r\nfunction Defaults () {}\r\n\r\nDefaults.prototype.translateId = true\r\n\r\nconst addHiddenPropsToTarget = function (target, props) {\r\n  DSUtils.forOwn(props, function (value, key) {\r\n    props[key] = {\r\n      writable: true,\r\n      value\r\n    }\r\n  })\r\n  Object.defineProperties(target, props)\r\n}\r\n\r\nconst fillIn = function (dest, src) {\r\n  DSUtils.forOwn(src, function (value, key) {\r\n    if (!dest.hasOwnProperty(key) || dest[key] === undefined) {\r\n      dest[key] = value\r\n    }\r\n  })\r\n}\r\n\r\nfunction unique (array) {\r\n  const seen = {}\r\n  const final = []\r\n  array.forEach(function (item) {\r\n    if (item in seen) {\r\n      return\r\n    }\r\n    final.push(item)\r\n    seen[item] = 0\r\n  })\r\n  return final\r\n}\r\n\r\n/**\r\n * MongoDBAdapter class.\r\n *\r\n * @example\r\n * import {DS} from 'js-data'\r\n * import MongoDBAdapter from 'js-data-mongodb'\r\n * const store = new DS()\r\n * const adapter = new MongoDBAdapter({\r\n *   uri: 'mongodb://localhost:27017'\r\n * })\r\n * store.registerAdapter('mongodb', adapter, { 'default': true })\r\n *\r\n * @class MongoDBAdapter\r\n * @param {Object} [opts] Configuration opts.\r\n * @param {string} [opts.uri=''] MongoDB URI.\r\n */\r\nexport default function MongoDBAdapter (opts) {\r\n  const self = this\r\n  if (typeof opts === 'string') {\r\n    opts = { uri: opts }\r\n  }\r\n  opts.uri || (opts.uri = 'mongodb://localhost:27017')\r\n  self.defaults = new Defaults()\r\n  DSUtils.deepMixIn(self.defaults, opts)\r\n  fillIn(self, opts)\r\n\r\n  /**\r\n   * A Promise that resolves to a reference to the MongoDB client being used by\r\n   * this adapter.\r\n   *\r\n   * @name MongoDBAdapter#client\r\n   * @type {Object}\r\n   */\r\n  self.client = new DSUtils.Promise(function (resolve, reject) {\r\n    MongoClient.connect(opts.uri, function (err, db) {\r\n      return err ? reject(err) : resolve(db)\r\n    })\r\n  })\r\n}\r\n\r\naddHiddenPropsToTarget(MongoDBAdapter.prototype, {\r\n  /**\r\n   * Return a Promise that resolves to a reference to the MongoDB client being\r\n   * used by this adapter.\r\n   *\r\n   * Useful when you need to do anything custom with the MongoDB client library.\r\n   *\r\n   * @name MongoDBAdapter#getClient\r\n   * @method\r\n   * @return {Object} MongoDB client.\r\n   */\r\n  getClient () {\r\n    return this.client\r\n  },\r\n\r\n  /**\r\n   * Map filtering params in a selection query to MongoDB a filtering object.\r\n   *\r\n   * Handles the following:\r\n   *\r\n   * - where\r\n   *   - and bunch of filtering operators\r\n   *\r\n   * @name MongoDBAdapter#getQuery\r\n   * @method\r\n   * @return {Object}\r\n   */\r\n  getQuery (Resource, query) {\r\n    query || (query = {})\r\n    query.where || (query.where = {})\r\n\r\n    DSUtils.forOwn(query, function (v, k) {\r\n      if (reserved.indexOf(k) === -1) {\r\n        if (DSUtils.isObject(v)) {\r\n          query.where[k] = v\r\n        } else {\r\n          query.where[k] = {\r\n            '==': v\r\n          }\r\n        }\r\n        delete query[k]\r\n      }\r\n    })\r\n\r\n    let mongoQuery = {}\r\n\r\n    if (Object.keys(query.where).length) {\r\n      DSUtils.forOwn(query.where, function (criteria, field) {\r\n        if (!DSUtils.isObject(criteria)) {\r\n          query.where[field] = {\r\n            '==': criteria\r\n          }\r\n        }\r\n        DSUtils.forOwn(criteria, function (v, op) {\r\n          if (op === '==' || op === '===') {\r\n            mongoQuery[field] = v\r\n          } else if (op === '!=' || op === '!==') {\r\n            mongoQuery[field] = mongoQuery[field] || {}\r\n            mongoQuery[field].$ne = v\r\n          } else if (op === '>') {\r\n            mongoQuery[field] = mongoQuery[field] || {}\r\n            mongoQuery[field].$gt = v\r\n          } else if (op === '>=') {\r\n            mongoQuery[field] = mongoQuery[field] || {}\r\n            mongoQuery[field].$gte = v\r\n          } else if (op === '<') {\r\n            mongoQuery[field] = mongoQuery[field] || {}\r\n            mongoQuery[field].$lt = v\r\n          } else if (op === '<=') {\r\n            mongoQuery[field] = mongoQuery[field] || {}\r\n            mongoQuery[field].$lte = v\r\n          } else if (op === 'in') {\r\n            mongoQuery[field] = mongoQuery[field] || {}\r\n            mongoQuery[field].$in = v\r\n          } else if (op === 'notIn') {\r\n            mongoQuery[field] = mongoQuery[field] || {}\r\n            mongoQuery[field].$nin = v\r\n          } else if (op === '|==' || op === '|===') {\r\n            mongoQuery.$or = mongoQuery.$or || []\r\n            let orEqQuery = {}\r\n            orEqQuery[field] = v\r\n            mongoQuery.$or.push(orEqQuery)\r\n          } else if (op === '|!=' || op === '|!==') {\r\n            mongoQuery.$or = mongoQuery.$or || []\r\n            let orNeQuery = {}\r\n            orNeQuery[field] = {\r\n              '$ne': v\r\n            }\r\n            mongoQuery.$or.push(orNeQuery)\r\n          } else if (op === '|>') {\r\n            mongoQuery.$or = mongoQuery.$or || []\r\n            let orGtQuery = {}\r\n            orGtQuery[field] = {\r\n              '$gt': v\r\n            }\r\n            mongoQuery.$or.push(orGtQuery)\r\n          } else if (op === '|>=') {\r\n            mongoQuery.$or = mongoQuery.$or || []\r\n            let orGteQuery = {}\r\n            orGteQuery[field] = {\r\n              '$gte': v\r\n            }\r\n            mongoQuery.$or.push(orGteQuery)\r\n          } else if (op === '|<') {\r\n            mongoQuery.$or = mongoQuery.$or || []\r\n            let orLtQuery = {}\r\n            orLtQuery[field] = {\r\n              '$lt': v\r\n            }\r\n            mongoQuery.$or.push(orLtQuery)\r\n          } else if (op === '|<=') {\r\n            mongoQuery.$or = mongoQuery.$or || []\r\n            let orLteQuery = {}\r\n            orLteQuery[field] = {\r\n              '$lte': v\r\n            }\r\n            mongoQuery.$or.push(orLteQuery)\r\n          } else if (op === '|in') {\r\n            mongoQuery.$or = mongoQuery.$or || []\r\n            let orInQuery = {}\r\n            orInQuery[field] = {\r\n              '$in': v\r\n            }\r\n            mongoQuery.$or.push(orInQuery)\r\n          } else if (op === '|notIn') {\r\n            mongoQuery.$or = mongoQuery.$or || []\r\n            let orNinQuery = {}\r\n            orNinQuery[field] = {\r\n              '$nin': v\r\n            }\r\n            mongoQuery.$or.push(orNinQuery)\r\n          }\r\n        })\r\n      })\r\n    }\r\n\r\n    return mongoQuery\r\n  },\r\n\r\n  /**\r\n   * Map non-filtering params in a selection query to MongoDB query options.\r\n   *\r\n   * Handles the following:\r\n   *\r\n   * - limit\r\n   * - skip/offset\r\n   * - orderBy/sort\r\n   *\r\n   * @name MongoDBAdapter#getQueryOptions\r\n   * @method\r\n   * @return {Object}\r\n   */\r\n  getQueryOptions (Resource, query) {\r\n    query = query || {}\r\n    query.orderBy = query.orderBy || query.sort\r\n    query.skip = query.skip || query.offset\r\n\r\n    let queryOptions = {}\r\n\r\n    if (query.orderBy) {\r\n      if (DSUtils.isString(query.orderBy)) {\r\n        query.orderBy = [\r\n          [query.orderBy, 'asc']\r\n        ]\r\n      }\r\n      for (var i = 0; i < query.orderBy.length; i++) {\r\n        if (DSUtils.isString(query.orderBy[i])) {\r\n          query.orderBy[i] = [query.orderBy[i], 'asc']\r\n        }\r\n      }\r\n      queryOptions.sort = query.orderBy\r\n    }\r\n\r\n    if (query.skip) {\r\n      queryOptions.skip = +query.skip\r\n    }\r\n\r\n    if (query.limit) {\r\n      queryOptions.limit = +query.limit\r\n    }\r\n\r\n    return queryOptions\r\n  },\r\n\r\n  /**\r\n   * TODO\r\n   *\r\n   * @name MongoDBAdapter#translateId\r\n   * @method\r\n   * @return {*}\r\n   */\r\n  translateId (r, opts) {\r\n    opts || (opts = {})\r\n    if (typeof opts.translateId === 'boolean' ? opts.translateId : this.defaults.translateId) {\r\n      if (DSUtils.isArray(r)) {\r\n        r.forEach(function (_r) {\r\n          const __id = _r._id ? _r._id.toString() : _r._id\r\n          _r._id = typeof __id === 'string' ? __id : _r._id\r\n        })\r\n      } else if (DSUtils.isObject(r)) {\r\n        const __id = r._id ? r._id.toString() : r._id\r\n        r._id = typeof __id === 'string' ? __id : r._id\r\n      }\r\n    }\r\n    return r\r\n  },\r\n\r\n  /**\r\n   * TODO\r\n   *\r\n   * @name MongoDBAdapter#origify\r\n   * @method\r\n   * @return {Object}\r\n   */\r\n  origify (opts) {\r\n    opts = opts || {}\r\n    if (typeof opts.orig === 'function') {\r\n      return opts.orig()\r\n    }\r\n    return opts\r\n  },\r\n\r\n  /**\r\n   * TODO\r\n   *\r\n   * @name MongoDBAdapter#makeHasManyForeignKey\r\n   * @method\r\n   * @return {*}\r\n   */\r\n  toObjectID (Resource, id) {\r\n    if (id !== undefined && Resource.idAttribute === '_id' && typeof id === 'string' && ObjectID.isValid(id) && !(id instanceof ObjectID)) {\r\n      return new ObjectID(id)\r\n    }\r\n    return id\r\n  },\r\n\r\n  /**\r\n   * TODO\r\n   *\r\n   * If the foreignKeys in your database are saved as ObjectIDs, then override\r\n   * this method and change it to something like:\r\n   *\r\n   * ```\r\n   * return this.toObjectID(Resource, this.constructor.prototype.makeHasManyForeignKey.call(this, Resource, def, record))\r\n   * ```\r\n   *\r\n   * There may be other reasons why you may want to override this method, like\r\n   * when the id of the parent doesn't exactly match up to the key on the child.\r\n   *\r\n   * @name MongoDBAdapter#makeHasManyForeignKey\r\n   * @method\r\n   * @return {*}\r\n   */\r\n  makeHasManyForeignKey (Resource, def, record) {\r\n    return DSUtils.get(record, Resource.idAttribute)\r\n  },\r\n\r\n  /**\r\n   * TODO\r\n   *\r\n   * @name MongoDBAdapter#loadHasMany\r\n   * @method\r\n   * @return {Promise}\r\n   */\r\n  loadHasMany (Resource, def, records, __options) {\r\n    const self = this\r\n    let singular = false\r\n\r\n    if (DSUtils.isObject(records) && !DSUtils.isArray(records)) {\r\n      singular = true\r\n      records = [records]\r\n    }\r\n    const IDs = records.map(function (record) {\r\n      return self.makeHasManyForeignKey(Resource, def, record)\r\n    })\r\n    const query = {}\r\n    const criteria = query[def.foreignKey] = {}\r\n    if (singular) {\r\n      // more efficient query when we only have one record\r\n      criteria['=='] = IDs[0]\r\n    } else {\r\n      criteria['in'] = IDs.filter(function (id) {\r\n        return id\r\n      })\r\n    }\r\n    return self.findAll(Resource.getResource(def.relation), query, __options).then(function (relatedItems) {\r\n      records.forEach(function (record) {\r\n        let attached = []\r\n        // avoid unneccesary iteration when we only have one record\r\n        if (singular) {\r\n          attached = relatedItems\r\n        } else {\r\n          relatedItems.forEach(function (relatedItem) {\r\n            if (DSUtils.get(relatedItem, def.foreignKey) === record[Resource.idAttribute]) {\r\n              attached.push(relatedItem)\r\n            }\r\n          })\r\n        }\r\n        DSUtils.set(record, def.localField, attached)\r\n      })\r\n    })\r\n  },\r\n\r\n  /**\r\n   * TODO\r\n   *\r\n   * @name MongoDBAdapter#loadHasOne\r\n   * @method\r\n   * @return {Promise}\r\n   */\r\n  loadHasOne (Resource, def, records, __options) {\r\n    if (DSUtils.isObject(records) && !DSUtils.isArray(records)) {\r\n      records = [records]\r\n    }\r\n    return this.loadHasMany(Resource, def, records, __options).then(function () {\r\n      records.forEach(function (record) {\r\n        const relatedData = DSUtils.get(record, def.localField)\r\n        if (DSUtils.isArray(relatedData) && relatedData.length) {\r\n          DSUtils.set(record, def.localField, relatedData[0])\r\n        }\r\n      })\r\n    })\r\n  },\r\n\r\n  /**\r\n   * TODO\r\n   *\r\n   * @name MongoDBAdapter#makeBelongsToForeignKey\r\n   * @method\r\n   * @return {*}\r\n   */\r\n  makeBelongsToForeignKey (Resource, def, record) {\r\n    return this.toObjectID(Resource.getResource(def.relation), DSUtils.get(record, def.localKey))\r\n  },\r\n\r\n  /**\r\n   * TODO\r\n   *\r\n   * @name MongoDBAdapter#loadBelongsTo\r\n   * @method\r\n   * @return {Promise}\r\n   */\r\n  loadBelongsTo (Resource, def, records, __options) {\r\n    const self = this\r\n    const relationDef = Resource.getResource(def.relation)\r\n\r\n    if (DSUtils.isObject(records) && !DSUtils.isArray(records)) {\r\n      const record = records\r\n      return self.find(relationDef, self.makeBelongsToForeignKey(Resource, def, record), __options).then(function (relatedItem) {\r\n        DSUtils.set(record, def.localField, relatedItem)\r\n      })\r\n    } else {\r\n      const keys = records.map(function (record) {\r\n        return self.makeBelongsToForeignKey(Resource, def, record)\r\n      }).filter(function (key) {\r\n        return key\r\n      })\r\n      return self.findAll(relationDef, {\r\n        where: {\r\n          [relationDef.idAttribute]: {\r\n            'in': keys\r\n          }\r\n        }\r\n      }, __options).then(function (relatedItems) {\r\n        records.forEach(function (record) {\r\n          relatedItems.forEach(function (relatedItem) {\r\n            if (relatedItem[relationDef.idAttribute] === record[def.localKey]) {\r\n              DSUtils.set(record, def.localField, relatedItem)\r\n            }\r\n          })\r\n        })\r\n      })\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Retrieve the record with the given primary key.\r\n   *\r\n   * @name MongoDBAdapter#find\r\n   * @method\r\n   * @param {Object} Resource The Resource.\r\n   * @param {(string|number)} id Primary key of the record to retrieve.\r\n   * @param {Object} [opts] Configuration options.\r\n   * @param {string[]} [opts.with=[]] TODO\r\n   * @return {Promise}\r\n   */\r\n  find (Resource, id, options) {\r\n    const self = this\r\n    let instance\r\n    options = self.origify(options)\r\n    options.with || (options.with = [])\r\n    return self.getClient().then(function (client) {\r\n      return new DSUtils.Promise(function (resolve, reject) {\r\n        let mongoQuery = {}\r\n        mongoQuery[Resource.idAttribute] = self.toObjectID(Resource, id)\r\n        options.fields = options.fields || {}\r\n        client.collection(Resource.table || underscore(Resource.name)).findOne(mongoQuery, options, function (err, r) {\r\n          if (err) {\r\n            reject(err)\r\n          } else if (!r) {\r\n            reject(new Error('Not Found!'))\r\n          } else {\r\n            resolve(self.translateId(r, options))\r\n          }\r\n        })\r\n      })\r\n    }).then(function (_instance) {\r\n      instance = _instance\r\n      let tasks = []\r\n      const relationList = Resource.relationList || []\r\n\r\n      relationList.forEach(function (def) {\r\n        let relationName = def.relation\r\n        let relationDef = Resource.getResource(relationName)\r\n        let containedName = null\r\n        if (options.with.indexOf(relationName) !== -1) {\r\n          containedName = relationName\r\n        } else if (options.with.indexOf(def.localField) !== -1) {\r\n          containedName = def.localField\r\n        }\r\n        if (containedName) {\r\n          let __options = DSUtils.deepMixIn({}, options.orig ? options.orig() : options)\r\n          __options.with = options.with.slice()\r\n          __options = DSUtils._(relationDef, __options)\r\n          DSUtils.remove(__options.with, containedName)\r\n          __options.with.forEach(function (relation, i) {\r\n            if (relation && relation.indexOf(containedName) === 0 && relation.length >= containedName.length && relation[containedName.length] === '.') {\r\n              __options.with[i] = relation.substr(containedName.length + 1)\r\n            } else {\r\n              __options.with[i] = ''\r\n            }\r\n          })\r\n\r\n          let task\r\n\r\n          if (def.foreignKey && (def.type === 'hasOne' || def.type === 'hasMany')) {\r\n            if (def.type === 'hasOne') {\r\n              task = self.loadHasOne(Resource, def, instance, __options)\r\n            } else {\r\n              task = self.loadHasMany(Resource, def, instance, __options)\r\n            }\r\n          } else if (def.type === 'hasMany' && def.localKeys) {\r\n            let localKeys = []\r\n            let itemKeys = instance[def.localKeys] || []\r\n            itemKeys = DSUtils.isArray(itemKeys) ? itemKeys : DSUtils.keys(itemKeys)\r\n            localKeys = localKeys.concat(itemKeys || [])\r\n            task = self.findAll(Resource.getResource(relationName), {\r\n              where: {\r\n                [relationDef.idAttribute]: {\r\n                  'in': unique(localKeys).filter((x) => x).map((x) => self.toObjectID(relationDef, x))\r\n                }\r\n              }\r\n            }, __options).then(function (relatedItems) {\r\n              DSUtils.set(instance, def.localField, relatedItems)\r\n              return relatedItems\r\n            })\r\n          } else if (def.type === 'belongsTo' || (def.type === 'hasOne' && def.localKey)) {\r\n            task = self.loadBelongsTo(Resource, def, instance, __options)\r\n          }\r\n\r\n          if (task) {\r\n            tasks.push(task)\r\n          }\r\n        }\r\n      })\r\n\r\n      return DSUtils.Promise.all(tasks)\r\n    }).then(function () {\r\n      return instance\r\n    })\r\n  },\r\n\r\n  /**\r\n   * Retrieve the records that match the selection query.\r\n   *\r\n   * @name MongoDBAdapter#findAll\r\n   * @method\r\n   * @param {Object} Resource The Resource.\r\n   * @param {Object} query Selection query.\r\n   * @param {Object} [opts] Configuration options.\r\n   * @param {string[]} [opts.with=[]] TODO\r\n   * @return {Promise}\r\n   */\r\n  findAll (Resource, query, options) {\r\n    const self = this\r\n    let items = null\r\n    options = self.origify(options ? DSUtils.copy(options) : {})\r\n    options.with = options.with || []\r\n    DSUtils.deepMixIn(options, self.getQueryOptions(Resource, query))\r\n    const mongoQuery = self.getQuery(Resource, query)\r\n    return self.getClient().then(function (client) {\r\n      return new DSUtils.Promise(function (resolve, reject) {\r\n        options.fields = options.fields || {}\r\n        client.collection(Resource.table || underscore(Resource.name)).find(mongoQuery, options).toArray((err, r) => {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve(self.translateId(r, options))\r\n          }\r\n        })\r\n      })\r\n    }).then(function (_items) {\r\n      items = _items\r\n      let tasks = []\r\n      const relationList = Resource.relationList || []\r\n      relationList.forEach(function (def) {\r\n        let relationName = def.relation\r\n        let relationDef = Resource.getResource(relationName)\r\n        let containedName = null\r\n        if (options.with.indexOf(relationName) !== -1) {\r\n          containedName = relationName\r\n        } else if (options.with.indexOf(def.localField) !== -1) {\r\n          containedName = def.localField\r\n        }\r\n        if (containedName) {\r\n          let __options = DSUtils.deepMixIn({}, options.orig ? options.orig() : options)\r\n          __options.with = options.with.slice()\r\n          __options = DSUtils._(relationDef, __options)\r\n          DSUtils.remove(__options.with, containedName)\r\n          __options.with.forEach(function (relation, i) {\r\n            if (relation && relation.indexOf(containedName) === 0 && relation.length >= containedName.length && relation[containedName.length] === '.') {\r\n              __options.with[i] = relation.substr(containedName.length + 1)\r\n            } else {\r\n              __options.with[i] = ''\r\n            }\r\n          })\r\n\r\n          let task\r\n\r\n          if (def.foreignKey && (def.type === 'hasOne' || def.type === 'hasMany')) {\r\n            if (def.type === 'hasMany') {\r\n              task = self.loadHasMany(Resource, def, items, __options)\r\n            } else {\r\n              task = self.loadHasOne(Resource, def, items, __options)\r\n            }\r\n          } else if (def.type === 'hasMany' && def.localKeys) {\r\n            let localKeys = []\r\n            items.forEach(function (item) {\r\n              let itemKeys = item[def.localKeys] || []\r\n              itemKeys = DSUtils.isArray(itemKeys) ? itemKeys : Object.keys(itemKeys)\r\n              localKeys = localKeys.concat(itemKeys || [])\r\n            })\r\n            task = self.findAll(Resource.getResource(relationName), {\r\n              where: {\r\n                [relationDef.idAttribute]: {\r\n                  'in': unique(localKeys).filter((x) => x).map((x) => self.toObjectID(relationDef, x))\r\n                }\r\n              }\r\n            }, __options).then(function (relatedItems) {\r\n              items.forEach(function (item) {\r\n                let attached = []\r\n                let itemKeys = item[def.localKeys] || []\r\n                itemKeys = DSUtils.isArray(itemKeys) ? itemKeys : DSUtils.keys(itemKeys)\r\n                relatedItems.forEach(function (relatedItem) {\r\n                  if (itemKeys && itemKeys.indexOf(relatedItem[relationDef.idAttribute]) !== -1) {\r\n                    attached.push(relatedItem)\r\n                  }\r\n                })\r\n                DSUtils.set(item, def.localField, attached)\r\n              })\r\n              return relatedItems\r\n            })\r\n          } else if (def.type === 'belongsTo' || (def.type === 'hasOne' && def.localKey)) {\r\n            task = self.loadBelongsTo(Resource, def, items, __options)\r\n          }\r\n\r\n          if (task) {\r\n            tasks.push(task)\r\n          }\r\n        }\r\n      })\r\n      return DSUtils.Promise.all(tasks)\r\n    }).then(function () {\r\n      return items\r\n    })\r\n  },\r\n\r\n  /**\r\n   * Create a new record.\r\n   *\r\n   * @name MongoDBAdapter#create\r\n   * @method\r\n   * @param {Object} Resource The Resource.\r\n   * @param {Object} props The record to be created.\r\n   * @param {Object} [opts] Configuration options.\r\n   * @return {Promise}\r\n   */\r\n  create (Resource, props, opts) {\r\n    const self = this\r\n    props = DSUtils.removeCircular(DSUtils.omit(props, Resource.relationFields || []))\r\n    opts = self.origify(opts)\r\n\r\n    return self.getClient().then(function (client) {\r\n      return new DSUtils.Promise(function (resolve, reject) {\r\n        const collection = client.collection(Resource.table || underscore(Resource.name))\r\n        const method = collection.insertOne ? DSUtils.isArray(props) ? 'insertMany' : 'insertOne' : 'insert'\r\n        collection[method](props, opts, function (err, r) {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            r = r.ops ? r.ops : r\r\n            self.translateId(r, opts)\r\n            resolve(DSUtils.isArray(props) ? r : r[0])\r\n          }\r\n        })\r\n      })\r\n    })\r\n  },\r\n\r\n  /**\r\n   * Destroy the record with the given primary key.\r\n   *\r\n   * @name MongoDBAdapter#destroy\r\n   * @method\r\n   * @param {Object} Resource The Resource.\r\n   * @param {(string|number)} id Primary key of the record to destroy.\r\n   * @param {Object} [opts] Configuration options.\r\n   * @return {Promise}\r\n   */\r\n  destroy (Resource, id, opts) {\r\n    const self = this\r\n    opts = self.origify(opts)\r\n\r\n    return self.getClient().then(function (client) {\r\n      return new DSUtils.Promise(function (resolve, reject) {\r\n        const mongoQuery = {}\r\n        mongoQuery[Resource.idAttribute] = self.toObjectID(Resource, id)\r\n        const collection = client.collection(Resource.table || underscore(Resource.name))\r\n        collection[collection.deleteOne ? 'deleteOne' : 'remove'](mongoQuery, opts, function (err) {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve()\r\n          }\r\n        })\r\n      })\r\n    })\r\n  },\r\n\r\n  /**\r\n   * Destroy the records that match the selection query.\r\n   *\r\n   * @name MongoDBAdapter#destroyAll\r\n   * @method\r\n   * @param {Object} Resource the Resource.\r\n   * @param {Object} [query] Selection query.\r\n   * @param {Object} [opts] Configuration options.\r\n   * @return {Promise}\r\n   */\r\n  destroyAll (Resource, query, opts) {\r\n    const self = this\r\n    opts = self.origify(opts ? DSUtils.copy(opts) : {})\r\n\r\n    return self.getClient().then(function (client) {\r\n      DSUtils.deepMixIn(opts, self.getQueryOptions(Resource, query))\r\n      const mongoQuery = self.getQuery(Resource, query)\r\n      return new DSUtils.Promise(function (resolve, reject) {\r\n        const collection = client.collection(Resource.table || underscore(Resource.name))\r\n        collection[collection.deleteMany ? 'deleteMany' : 'remove'](mongoQuery, opts, function (err) {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve()\r\n          }\r\n        })\r\n      })\r\n    })\r\n  },\r\n\r\n  /**\r\n   * Apply the given update to the record with the specified primary key.\r\n   *\r\n   * @name MongoDBAdapter#update\r\n   * @method\r\n   * @param {Object} Resource The Resource.\r\n   * @param {(string|number)} id The primary key of the record to be updated.\r\n   * @param {Object} props The update to apply to the record.\r\n   * @param {Object} [opts] Configuration options.\r\n   * @return {Promise}\r\n   */\r\n  update (Resource, id, props, opts) {\r\n    const self = this\r\n    props = DSUtils.removeCircular(DSUtils.omit(props, Resource.relationFields || []))\r\n    opts = self.origify(opts)\r\n\r\n    return self.find(Resource, id, opts).then(function () {\r\n      return self.getClient()\r\n    }).then(function (client) {\r\n      return new DSUtils.Promise(function (resolve, reject) {\r\n        const mongoQuery = {}\r\n        mongoQuery[Resource.idAttribute] = self.toObjectID(Resource, id)\r\n        const collection = client.collection(Resource.table || underscore(Resource.name))\r\n        collection[collection.updateOne ? 'updateOne' : 'update'](mongoQuery, { $set: props }, opts, function (err) {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve()\r\n          }\r\n        })\r\n      })\r\n    }).then(function () {\r\n      return self.find(Resource, id, opts)\r\n    })\r\n  },\r\n\r\n  /**\r\n   * Apply the given update to all records that match the selection query.\r\n   *\r\n   * @name MongoDBAdapter#updateAll\r\n   * @method\r\n   * @param {Object} Resource The Resource.\r\n   * @param {Object} props The update to apply to the selected records.\r\n   * @param {Object} [query] Selection query.\r\n   * @param {Object} [opts] Configuration options.\r\n   * @return {Promise}\r\n   */\r\n  updateAll (Resource, props, query, opts) {\r\n    const self = this\r\n    let ids = []\r\n    props = DSUtils.removeCircular(DSUtils.omit(props, Resource.relationFields || []))\r\n    opts = self.origify(opts ? DSUtils.copy(opts) : {})\r\n    const mongoOptions = DSUtils.copy(opts)\r\n    mongoOptions.multi = true\r\n\r\n    return self.getClient().then(function (client) {\r\n      const queryOptions = self.getQueryOptions(Resource, query)\r\n      queryOptions.$set = props\r\n      const mongoQuery = self.getQuery(Resource, query)\r\n\r\n      return self.findAll(Resource, query, opts).then(function (items) {\r\n        ids = items.map(function (item) {\r\n          return self.toObjectID(Resource, item[Resource.idAttribute])\r\n        })\r\n\r\n        return new DSUtils.Promise(function (resolve, reject) {\r\n          const collection = client.collection(Resource.table || underscore(Resource.name))\r\n          collection[collection.updateMany ? 'updateMany' : 'update'](mongoQuery, queryOptions, mongoOptions, function (err) {\r\n            if (err) {\r\n              reject(err)\r\n            } else {\r\n              resolve()\r\n            }\r\n          })\r\n        })\r\n      }).then(function () {\r\n        const query = {}\r\n        query[Resource.idAttribute] = {\r\n          'in': ids\r\n        }\r\n        return self.findAll(Resource, query, opts)\r\n      })\r\n    })\r\n  }\r\n})\r\n"],"names":[],"mappings":"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"}